# This build request will build the official kube-cross image.
# The image will be tag with the string in build/build-image/cross/VERSION.
#
# You will need to build the k8s-cloud-builder image first.
# You could also use the official k8s-cloud-builder once we define the location.
# see https://github.com/rvkubiak/k8s-build/tree/update_k8s_builder/build_containe
timeout: '1800s'

steps:
  - name: 'gcr.io/$PROJECT_ID/k8s-cloud-builder'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        set -e
        docker_image="gcr.io/google_containers/kube-cross"
        version="$(cat ./build/build-image/cross/VERSION)"
        image="$${docker_image}:$${version}"
        echo "Building docker image $${image}"
        docker build --cache-from $${docker_image} -t $${image} ./build/build-image/cross/
        gcloud docker --server=gcr.io -- push $${image}

